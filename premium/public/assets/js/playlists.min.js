"use strict";class AIOVGPlaylistButtonElement extends HTMLElement{constructor(){super(),this._toggleDropdownButtonEl=null,this._closeDropdownButtonEl=null,this._dropdownEl=null,this._playlistTitleInputEl=null,this._createPlaylistButtonEl=null,this._isRendered=!1,this._isLoading=!1,this._options={}}connectedCallback(){if(this._isRendered||0==this.postId)return!1;this._options=window.aiovg_playlists,this._isRendered=!0,this._render(),this._toggleDropdownButtonEl=this.querySelector(".aiovg-button-toggle-dropdown"),this._closeDropdownButtonEl=this.querySelector(".aiovg-button-close-dropdown"),this._dropdownEl=this.querySelector(".aiovg-dropdown"),this._dropdownHeaderEl=this.querySelector(".aiovg-dropdown-header"),this._dropdownBodyEl=this.querySelector(".aiovg-dropdown-body"),this._dropdownFooterEl=this.querySelector(".aiovg-dropdown-footer"),this._playlistTitleInputEl=this.querySelector(".aiovg-form-control-title"),this._createPlaylistButtonEl=this.querySelector(".aiovg-button-create-playlist"),this._toggleDropdownButtonEl.addEventListener("click",t=>this._toggleDropdown(t)),this._closeDropdownButtonEl.addEventListener("click",t=>this._closeDropdown(t)),this._playlistTitleInputEl.addEventListener("input",t=>this._validatePlaylistTitleField(t)),this._createPlaylistButtonEl.addEventListener("click",t=>this._createPlaylist(t)),jQuery(this).on("change","input[type=checkbox]",t=>this._togglePlaylistItem(t)),this._load()}disconnectedCallback(){this._toggleDropdownButtonEl.removeEventListener("click",t=>this._toggleDropdown(t)),this._closeDropdownButtonEl.removeEventListener("click",t=>this._closeDropdown(t)),this._playlistTitleInputEl.removeEventListener("input",t=>this._validatePlaylistTitleField(t)),this._createPlaylistButtonEl.removeEventListener("click",t=>this._createPlaylist(t)),jQuery(this).off("change","input[type=checkbox]",t=>this._togglePlaylistItem(t))}get postId(){return parseInt(this.getAttribute("post_id")||0)}get userId(){return parseInt(this._options.user_id)}get limit(){return parseInt(this._options.limit)}get isLoaded(){return this.hasAttribute("loaded")}set isLoaded(t){return this.setAttribute("loaded",t)}_render(){let t="";t+='<button type="button" class="aiovg-button-toggle-dropdown">',t+='<svg xmlns="http://www.w3.org/2000/svg" fill="none" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="aiovg-flex-shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 16.875h3.375m0 0h3.375m-3.375 0V13.5m0 3.375v3.375M6 10.5h2.25a2.25 2.25 0 0 0 2.25-2.25V6a2.25 2.25 0 0 0-2.25-2.25H6A2.25 2.25 0 0 0 3.75 6v2.25A2.25 2.25 0 0 0 6 10.5Zm0 9.75h2.25A2.25 2.25 0 0 0 10.5 18v-2.25a2.25 2.25 0 0 0-2.25-2.25H6a2.25 2.25 0 0 0-2.25 2.25V18A2.25 2.25 0 0 0 6 20.25Zm9.75-9.75H18a2.25 2.25 0 0 0 2.25-2.25V6A2.25 2.25 0 0 0 18 3.75h-2.25A2.25 2.25 0 0 0 13.5 6v2.25a2.25 2.25 0 0 0 2.25 2.25Z" /></svg>',t+=this._options.i18n.button_add_to_playlist,t+="</button>",t+='<div class="aiovg-dropdown" hidden>',t+='<div class="aiovg-dropdown-header">',t+='<div class="aiovg-dropdown-status">',t+=this._options.i18n.dropdown_header_text,t+="</div>",t+='<button type="button" class="aiovg-button-close-dropdown">',t+='<svg xmlns="http://www.w3.org/2000/svg" fill="none" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="aiovg-flex-shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>',t+="</button>",t+="</div>",t+='<div class="aiovg-dropdown-body">',t+='<div class="aiovg-dropdown-no-items">',t+='<label class="aiovg-text-muted aiovg-text-small">',t+=this._options.i18n.playlists_not_found,t+="</label>",t+="</div>",t+="</div>",t+='<div class="aiovg-dropdown-footer">',t+='<div class="aiovg-form-group">',t+='<input type="text" class="aiovg-form-control aiovg-form-control-title" placeholder="'+this._options.i18n.title_field_placeholder+'" />',t+='<button type="button" class="aiovg-button-create-playlist" title="'+this._options.i18n.button_add_playlist+'">',t+='<svg xmlns="http://www.w3.org/2000/svg" fill="none" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="aiovg-flex-shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>',t+="</button>",t+="</div>",t+='<div class="aiovg-dropdown-status aiovg-text-muted aiovg-text-small aiovg-hide-if-empty">',t+="</div>",t+="</div>",t+="</div>",this.innerHTML=t}_load(){let t={action:"aiovg_get_playlists_info",user_id:this.userId,post_id:this.postId,security:this._options.ajax_nonce};this._fetch(t,t=>{if(this.isLoaded=!0,"success"==t.status){this._dropdownBodyEl.insertAdjacentHTML("afterbegin",t.html);let i=this._dropdownEl.querySelectorAll(".aiovg-item").length;i>0&&(this._dropdownEl.querySelector(".aiovg-dropdown-no-items").hidden=!0),this.limit>0&&(i>=this.limit?(this._dropdownFooterEl.querySelector(".aiovg-form-group").remove(),this._dropdownFooterEl.querySelector(".aiovg-dropdown-status").innerHTML=this._options.i18n.note_limit_reached):this._dropdownFooterEl.querySelector(".aiovg-dropdown-status").innerHTML=this._options.i18n.note_limit)}})}_toggleDropdown(t){return 0===this.userId?(alert(this._options.i18n.alert_login_required),!1):!!this.isLoaded&&void(this._dropdownEl.hidden=!this._dropdownEl.hidden)}_closeDropdown(t){this._dropdownEl.hidden=!0}_validatePlaylistTitleField(t){""==this._playlistTitleInputEl.value.trim()?this._playlistTitleInputEl.classList.add("aiovg-field-invalid"):this._playlistTitleInputEl.classList.remove("aiovg-field-invalid")}_createPlaylist(t){let i=this._playlistTitleInputEl.value.trim();if(""==i)return this._playlistTitleInputEl.classList.add("aiovg-field-invalid"),!1;if(this._isLoading)return!1;this._isLoading=!0,this._createPlaylistButtonEl.querySelector("svg").classList.add("aiovg-animate-rotate");let o={action:"aiovg_create_playlist",user_id:this.userId,post_id:this.postId,playlist_title:i,security:this._options.ajax_nonce};this._fetch(o,t=>{(this._playlistTitleInputEl.value="",this._isLoading=!1,this._createPlaylistButtonEl.querySelector("svg").classList.remove("aiovg-animate-rotate"),"success"==t.status)?(this._dropdownBodyEl.querySelector(".aiovg-dropdown-no-items").hidden=!0,this._dropdownBodyEl.insertAdjacentHTML("beforeend",t.html),this.limit>0&&this._dropdownEl.querySelectorAll(".aiovg-item").length>=this.limit&&(this._dropdownFooterEl.querySelector(".aiovg-form-group").remove(),this._dropdownFooterEl.querySelector(".aiovg-dropdown-status").innerHTML=this._options.i18n.note_limit_reached),this._dropdownEl.hidden=!0):alert(t.message)})}_togglePlaylistItem(t){let i='<span class="aiovg-spinner"></span> ';i+='<span class="aiovg-text-success aiovg-text-small">',i+=t.target.checked?this._options.i18n.status_added:this._options.i18n.status_removed,i+="</span>";let o=this._dropdownHeaderEl.querySelector(".aiovg-dropdown-status");o.innerHTML=i;let e={action:t.target.checked?"aiovg_add_to_playlist":"aiovg_remove_from_playlist",user_id:this.userId,post_id:this.postId,playlist_id:t.target.value,security:this._options.ajax_nonce};this._fetch(e,t=>{o.innerHTML=this._options.i18n.dropdown_header_text,"error"==t.status&&alert(t.message)})}_fetch(t,i){jQuery.post(this._options.ajax_url,t,i,"json")}}!function(t){var i=window.aiovg_playlists;t(function(){customElements.define("aiovg-playlist-button",AIOVGPlaylistButtonElement),document.addEventListener("click",t=>{let i=t.target.closest("aiovg-playlist-button");document.querySelectorAll("aiovg-playlist-button").forEach(t=>{t!==i&&(t.querySelector(".aiovg-dropdown").hidden=!0)})}),t("#aiovg-playlists .aiovg-item-playlist").each(function(){var o=t(this),e=parseInt(i.user_id),s=parseInt(o.data("playlist_id")),l=function(t){var e='<input type="text" class="aiovg-form-control aiovg-form-control-title aiovg-flex-grow-1" placeholder="'+i.i18n.title_field_placeholder+'" value="'+t+'" />';e+='<button type="button" class="aiovg-button-update-playlist aiovg-no-margin">',e+=i.i18n.button_update,e+="</button>",o.find(".aiovg-title").html(e)};o.on("click",".aiovg-button-edit-playlist",function(){l(o.find(".aiovg-title div").html())}),o.on("click",".aiovg-button-update-playlist",function(){var n=o.find(".aiovg-form-control-title").val(),a=' <div class="aiovg-flex-grow-1">'+n+"</div>";a+='<button type="button" class="aiovg-button-edit-playlist aiovg-no-margin aiovg-leading-none">',a+='<svg xmlns="http://www.w3.org/2000/svg" fill="none" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="aiovg-flex-shrink-0">',a+='<path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />',a+="</svg>",a+="</button>",o.find(".aiovg-title").html(a);var r={action:"aiovg_update_playlist",user_id:e,playlist_id:s,playlist_title:n,security:i.ajax_nonce};t.post(i.ajax_url,r,function(t){"error"==t.status&&(l(n),alert(t.message))},"json")})})})}(jQuery);