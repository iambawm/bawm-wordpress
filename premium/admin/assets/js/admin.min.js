!function(a){"use strict";function e(a){return!a||a.indexOf("://")>0||0===a.indexOf("//")?a:a=0===a.indexOf("/")?aiovg_admin.site_url+a:aiovg_admin.site_url+"/"+a}a(function(){var i=e(a("#aiovg-mp4").val());if(a("#aiovg-shortcode-form-videos select[name=slider_layout]").on("change",function(){var e=a(this).val();a("#aiovg-shortcode-form-videos").aiovgReplaceClass(/\aiovg-slider-layout-\S+/ig,"aiovg-slider-layout-"+e)}).trigger("change"),a("#aiovg-html5-thumbnail-generator").length){var t=document.getElementById("aiovg-thumbnail-generator-modal-body").innerHTML;a("#aiovg-html5-thumbnail-generator").magnificPopup({items:{src:"#aiovg-thumbnail-generator-modal",type:"inline"},callbacks:{open:function(){if(document.getElementById("aiovg-thumbnail-generator-modal-body").innerHTML=t,i=e(document.getElementById("aiovg-mp4").value)){var o=document.getElementById("aiovg-thumbnail-generator-player"),n=document.getElementById("aiovg-thumbnail-generator-canvas"),r=n.getContext("2d"),l=document.getElementById("aiovg-thumbnail-generator-seekto"),s=document.getElementById("aiovg-thumbnail-generator-button");o.src=i,o.load(),o.addEventListener("error",function(){var e='<div class="aiovg-notice aiovg-notice-error">'+aiovg_premium_admin.i18n.thumbnail_generator_cors_error+"</div>";a("#aiovg-thumbnail-generator-modal-body").prepend(e)},!0),o.addEventListener("loadedmetadata",function(){var e=o.duration,t="";n.width=o.videoWidth,n.height=o.videoHeight;for(var g=0;g<Math.floor(e);g+=4)t+='<option value="'+g+'">'+g+"</option>";l.innerHTML=t,l.disabled=!1,s.disabled=!1,l.addEventListener("change",function(){o.currentTime=a(this).val(),l.disabled=!0,s.disabled=!0}),o.addEventListener("timeupdate",function(){l.disabled=!1,s.disabled=!1});var v=!1;s.addEventListener("click",function(){if(v)return!1;v=!0;var e,t=s.innerHTML;s.innerHTML='<div class="spinner"></div>',r.drawImage(o,0,0,o.videoWidth,o.videoHeight);var g="";try{g=n.toDataURL()}catch(d){s.innerHTML=t,l.disabled=!0,s.disabled=!0;var u='<div class="aiovg-notice aiovg-notice-error">'+aiovg_premium_admin.i18n.thumbnail_generator_cors_error+"</div>";return a("#aiovg-thumbnail-generator-modal-body").prepend(u),!1}var m=new FormData;m.append("action","aiovg_upload_base64_image"),m.append("video",i),m.append("index",a("#aiovg-thumbnail-generator .aiovg-item-thumbnail").length),m.append("security",aiovg_admin.ajax_nonce);var c=function a(e){i=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var i,t=e.split(",")[0].split(":")[1].split(";")[0],o=new Uint8Array(i.length),n=0;n<i.length;n++)o[n]=i.charCodeAt(n);return new Blob([o],{type:t})}(g);m.append("image_data",c,"temp.png"),(e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){4==e.readyState&&200==e.status&&(s.innerHTML=t,""!=e.responseText&&(a(e.responseText).insertBefore("#aiovg-html5-thumbnail-generator"),a("#aiovg-thumbnail-generator input[type=radio]:last").prop("checked",!0).trigger("change")),a("#aiovg-thumbnail-generator .aiovg-item-thumbnail").length>0?(a("#aiovg-thumbnail-generator .aiovg-header").html(aiovg_premium_admin.i18n.thumbnail_generator_select_image),a("#aiovg-thumbnail-generator .aiovg-footer").show()):(a("#aiovg-thumbnail-generator .aiovg-header").html(aiovg_premium_admin.i18n.thumbnail_generator_capture_image),a("#aiovg-thumbnail-generator .aiovg-footer").hide()),a.magnificPopup.close())},e.open("POST",ajaxurl),e.send(m)})})}else{var g='<div class="aiovg-notice aiovg-notice-error">'+aiovg_premium_admin.i18n.thumbnail_generator_video_not_found+"</div>";a("#aiovg-thumbnail-generator-modal-body").prepend(g)}},close:function(){document.getElementById("aiovg-thumbnail-generator-modal-body").innerHTML=""}}})}a("#aiovg-mp4").on("blur file.uploaded",function(){if(!aiovg_premium_admin.ffmpeg_enabled)return!1;var t=e(a(this).val());if(!t||t==i)return!1;i=t;var o='<span class="spinner"></span> ';o+="<span>"+aiovg_premium_admin.i18n.thumbnail_generator_processing+"</span>",a("#aiovg-thumbnail-generator").addClass("aiovg-processing").find(".aiovg-header").html(o);var n={action:"aiovg_ffmpeg_generate_images",url:i,security:aiovg_admin.ajax_nonce};a.post(ajaxurl,n,function(e){a("#aiovg-thumbnail-generator").removeClass("aiovg-processing"),a("#aiovg-thumbnail-generator .aiovg-header").html(""),a("#aiovg-thumbnail-generator .aiovg-item-thumbnail").remove(),""!=e&&(a("#aiovg-html5-thumbnail-generator").length?a(e).insertBefore("#aiovg-html5-thumbnail-generator"):a("#aiovg-thumbnail-generator .aiovg-body").html(e),""==a("#aiovg-image").val()&&a("#aiovg-thumbnail-generator input[type=radio]:first").prop("checked",!0).trigger("change")),a("#aiovg-thumbnail-generator .aiovg-item-thumbnail").length>0?(a("#aiovg-thumbnail-generator .aiovg-header").html(aiovg_premium_admin.i18n.thumbnail_generator_select_image),a("#aiovg-thumbnail-generator .aiovg-footer").show()):(o='<span class="aiovg-text-error">'+aiovg_premium_admin.i18n.ffmpeg_thumbnail_generation_failed+"</span> ",o+="<span>"+aiovg_premium_admin.i18n.thumbnail_generator_capture_image+"</span>",a("#aiovg-thumbnail-generator .aiovg-header").html(o),a("#aiovg-thumbnail-generator .aiovg-footer").hide())})}),a("#aiovg-thumbnail-generator").on("click",".aiovg-item-thumbnail",function(){a(this).find("input[type=radio]").prop("checked",!0).trigger("change")}),a("#aiovg-thumbnail-generator").on("change","input[type=radio]",function(){var e=a("#aiovg-thumbnail-generator input[type=radio]:checked").val();a("#aiovg-image").val(e)}),a("#aiovg-override_vast_url").on("change",function(){this.checked?a("#aiovg-vast_url").show():a("#aiovg-vast_url").hide()}).trigger("change"),a("#aiovg-videos-settings tr.slider_layout select").on("change",function(){var e=a(this).val();a("#aiovg-videos-settings").aiovgReplaceClass(/\aiovg-slider-layout-\S+/ig,"aiovg-slider-layout-"+e)}).trigger("change"),a("#aiovg-test-ffmpeg-button").on("click",function(){var e={action:"aiovg_ffmpeg_status",ffmpeg_path:a("#aiovg-ffmpeg-path").val(),security:aiovg_admin.ajax_nonce};if(""==e.ffmpeg_path)return!1;a("#aiovg-ffmpeg-status").html('<span class="spinner"></span>'),a.post(ajaxurl,e,function(e){var i="";i="success"==e.status?'<span class="aiovg-text-success">'+e.message+"</span>":'<span class="aiovg-text-error">'+e.message+"</span>",a("#aiovg-ffmpeg-status").html(i)},"json")}),a(".aiovg-automations-field-service .aiovg-automations-field").on("change",function(e){e.preventDefault();var i=a(".aiovg-automations-field-service .aiovg-automations-field:checked").val();a("#aiovg-automations-sources .aiovg-table").aiovgReplaceClass(/\aiovg-automations-service-\S+/ig,"aiovg-automations-service-"+i),a(".aiovg-automations-fields-"+i+" .aiovg-automations-field-type .aiovg-automations-field").trigger("change")}),a(".aiovg-automations-field-type .aiovg-automations-field").on("change",function(e){e.preventDefault();var i=a(this).val();a("#aiovg-automations-sources .aiovg-table").aiovgReplaceClass(/\aiovg-automations-type-\S+/ig,"aiovg-automations-type-"+i)}),a(document).on("click",".aiovg-automations-preview",function(e){e.preventDefault(),a("#aiovg-automations-preview-modal .aiovg-modal-body").html(aiovg_premium_admin.i18n.loading_api_data);var i={action:"aiovg_automations_test_run",service:a(".aiovg-automations-field-service .aiovg-automations-field:checked").val(),video_date:a("#aiovg-video_date").val(),security:aiovg_admin.ajax_nonce};i.type=a(".aiovg-automations-fields-"+i.service+" .aiovg-automations-field-type .aiovg-automations-field").val(),i.src=a(".aiovg-automations-fields-"+i.service+" .aiovg-automations-field-"+i.type+" .aiovg-automations-field").val(),"vimeo"==i.service&&(i.username=a(".aiovg-automations-fields-vimeo .aiovg-automations-field-username .aiovg-automations-field").val(),i.filter_tag=a(".aiovg-automations-fields-vimeo .aiovg-automations-field-filter_tag .aiovg-automations-field").val(),i.filter_tag_exclude=a(".aiovg-automations-fields-vimeo .aiovg-automations-field-filter_tag_exclude .aiovg-automations-field").val(),i.include_subfolders=a(".aiovg-automations-fields-vimeo .aiovg-automations-field-include_subfolders .aiovg-automations-field:checked").val()),a.post(ajaxurl,i,function(e){a("#aiovg-automations-preview-modal .aiovg-modal-body").html(e)})}),a(document).on("change",".aiovg-widget-form-videos .aiovg-widget-input-slider_layout",function(){var e=a(this).val();a(this).closest(".aiovg-widget-form-videos").aiovgReplaceClass(/\aiovg-slider-layout-\S+/ig,"aiovg-slider-layout-"+e)}),"undefined"!=typeof wp&&void 0!==wp.hooks&&wp.hooks.addFilter("aiovg_block_toggle_controls","aiovg/videos",function(a,e,i){switch(e){case"columns":"slider"==i.template&&"player"==i.slider_layout&&(a=!1),"playlist"==i.template&&(a=!1);break;case"link_title":case"show_player_title":case"show_player_description":case"show_player_like_button":case"show_player_playlist_button":"classic"==i.template||"playlist"==i.template?a=!1:"slider"==i.template&&"thumbnails"==i.slider_layout&&(a=!1);break;case"show_pagination":a="slider"!=i.template&&"playlist"!=i.template&&"compact"!=i.template;break;case"show_more":case"more_label":a="compact"==i.template;break;case"slider_layout":case"arrows":case"arrow_size":case"arrow_radius":case"arrow_top_offset":case"arrow_left_offset":case"arrow_right_offset":case"arrow_bg_color":case"arrow_icon_color":case"dots":case"dot_size":case"dot_color":a="slider"==i.template;break;case"slider_autoplay":case"autoplay_speed":a="slider"==i.template&&"both"!=i.slider_layout;break;case"playlist_position":case"playlist_color":case"playlist_width":case"playlist_height":a="playlist"==i.template;break;case"autoadvance":"classic"==i.template?a=!1:"slider"==i.template&&"thumbnails"==i.slider_layout&&(a=!1)}return a})})}(jQuery);